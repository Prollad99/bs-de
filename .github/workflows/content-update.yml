name: Aktualisiere Links und Bereitstellung

on:
  schedule:
    - cron: '*/30 * * * *' # L√§uft alle 30 Minuten
  push:
    branches:
      - main

jobs:
  links-aktualisieren:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        game:
          - coin-master
          - monopoly-go
          - bingo-blitz
          - dice-dreams
          - match-masters
          - solitaire-grand-harvest
          - slotpark
          - house-of-fun
          - slotomania
          - bingo-bash
          - huuuge-casino
          - wsop
          - crazy-coin
          - gametwist

    steps:
      - name: Repository auschecken
        uses: actions/checkout@v2

      - name: Node-Module zwischenspeichern
        uses: actions/cache@v2
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: Abh√§ngigkeiten installieren
        run: npm install

      # Install Playwright Browsers
      - name: Installiere Playwright-Browser
        run: npx playwright install

      - name: Links abrufen und aktualisieren
        run: |
          node index-js/${{ matrix.game }}.js
          echo "Inhalt von links-json/${{ matrix.game }}.json:"
          cat links-json/${{ matrix.game }}.json
          echo "Inhalt von _includes/${{ matrix.game }}.html:"
          cat _includes/${{ matrix.game }}.html

      - name: Dynamische Beitragsinhalte generieren
        run: |
          SPIEL_NAME=${{ matrix.game }}
          SPIEL_NAME_KAPITALISIERT=$(echo "$SPIEL_NAME" | sed 's/-/ /g' | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)}1')

          ABSATZ_DATEI="_includes/${SPIEL_NAME}_post.html"

          # Datei leeren, um √Ñnderungen sicherzustellen
          > "$ABSATZ_DATEI"

          # Neuen Inhalt schreiben
          ABSATZ="Willkommen zu den neuesten ${SPIEL_NAME_KAPITALISIERT}-Belohnungen!\n\n
          Suchst du nach den aktuellsten ${SPIEL_NAME_KAPITALISIERT}-Freispielen, M√ºnzen oder Bonusangeboten? Du bist hier genau richtig! Wir aktualisieren diese Seite t√§glich mit den neuesten Belohnungslinks, damit du das Beste aus deinem Spielerlebnis herausholen kannst.\n\n
          **Warum du t√§glich vorbeischauen solltest:**\n
          - üèÜ **T√§glich neue Links** ‚Äì Verpasse keine Belohnung mehr.\n
          - ‚è≥ **Einfache Einl√∂sung** ‚Äì Ein Klick und du bekommst deine Belohnung.\n
          - üéØ **Sichere & offizielle Quellen** ‚Äì Keine Hacks oder Cheats, nur legitime Links.\n\n
          **Hinweis:** Diese Belohnungen stammen aus offiziellen ${SPIEL_NAME_KAPITALISIERT}-Quellen und sind v√∂llig kostenlos."
          echo -e "$ABSATZ" > "$ABSATZ_DATEI"

          # Erzwinge √Ñnderungsdetektion
          touch "$ABSATZ_DATEI"
          git update-index --assume-unchanged "$ABSATZ_DATEI"

      - name: Dynamische Footer-Inhalte generieren
        run: |
          SPIEL_NAME=${{ matrix.game }}
          SPIEL_NAME_KAPITALISIERT=$(echo "$SPIEL_NAME" | sed 's/-/ /g' | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)}1')

          FOOTER_DATEI="_includes/${SPIEL_NAME}_footer.html"

          # Datei leeren, um √Ñnderungen zu erzwingen
          > "$FOOTER_DATEI"

          FOOTER="### So holst du dir deine ${SPIEL_NAME_KAPITALISIERT}-Belohnungen\n\n
          Das Einfordern deiner t√§glichen Belohnungen in ${SPIEL_NAME_KAPITALISIERT} ist schnell und einfach! Folge diesen Schritten:\n
          1Ô∏è‚É£ **Belohnungslink ausw√§hlen** ‚Äì Klicke auf einen der oben aufgef√ºhrten Links.\n
          2Ô∏è‚É£ **Spiel √∂ffnen** ‚Äì Der Link leitet dich zur ${SPIEL_NAME_KAPITALISIERT}-App oder Website weiter.\n
          3Ô∏è‚É£ **Belohnung erhalten** ‚Äì Logge dich ein und erhalte deine Freispiele oder M√ºnzen.\n\n
          **Noch mehr Boni?**\n
          - Tritt der ${SPIEL_NAME_KAPITALISIERT}-Community bei und tausche dich mit anderen Spielern aus.\n
          - Folge den offiziellen ${SPIEL_NAME_KAPITALISIERT}-Social-Media-Kan√§len, um exklusive Events nicht zu verpassen.\n\n
          Genie√üe dein Spiel und viel Spa√ü mit den t√§glichen ${SPIEL_NAME_KAPITALISIERT}-Belohnungen! üéâ"
          echo -e "$FOOTER" > "$FOOTER_DATEI"

          # Erzwinge √Ñnderungsdetektion
          touch "$FOOTER_DATEI"
          git update-index --assume-unchanged "$FOOTER_DATEI"

      - name: √Ñnderungen committen und pushen
        run: |
          git config --global user.email "prolladmail@gmail.com"
          git config --global user.name "Prollad99"

          git add -A
          git commit -m "Erzwinge Update f√ºr ${SPIEL_NAME_KAPITALISIERT}" || echo "Kein Commit erforderlich"
          git push --force https://x-access-token:${{ secrets.ACTIONS_DEPLOY_KEY }}@github.com/Prollad99/bs-de.git || true