name: Automated Content Updates & SEO Optimization

on:
  schedule:
    - cron: '*/15 * * * *' # Run every 15 minutes
  push:
    branches:
      - main

jobs:
  content-update:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        game:
          - coin-master
          - monopoly-go
          - bingo-blitz
          - dice-dreams
          - match-masters
          - solitaire-grand-harvest
          - slotpark
          - house-of-fun
          - slotomania
          - bingo-bash
          - huuuge-casino
          - wsop
          - crazy-coin

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Cache Dependencies
        uses: actions/cache@v3
        with:
          path: |
            ~/.npm
            ~/.cache/playwright
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}

      - name: Install Dependencies
        run: |
          npm install
          npx playwright install --with-deps

      - name: Update Game Links
        run: |
          node index-js/${{ matrix.game }}.js
          echo "Updated links saved for ${{ matrix.game }}"

      - name: Generate SEO-Optimized Posts
        env:
          CURRENT_DATE: $(date +'%d.%m.%Y')
        run: |
          GAME_NAME=${{ matrix.game }}
          FORMATTED_GAME_NAME=$(echo "$GAME_NAME" | sed 's/-/ /g' | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)}1')
          
          POST_FILE="_includes/${GAME_NAME}_post.html"
          
          SEO_CONTENT="### üéÆ $FORMATTED_GAME_NAME Kostenlose Belohnungen (Aktualisiert: $CURRENT_DATE)

          **Sichere dir t√§glich $FORMATTED_GAME_NAME Boni!** Als erfahrene Spieler wissen wir, wie wichtig kostenlose Ressourcen f√ºr dein Spielerlebnis sind. Hier findest du:

          ‚úÖ **100% verifizierte Links** (automatisch alle 15 Minuten aktualisiert)  
          ‚úÖ **Exklusive VIP-Boni**, die nicht in sozialen Medien verf√ºgbar sind  
          ‚úÖ **Multi-Plattform-Support** (Android, iOS, Facebook)  

          **Top 3 $FORMATTED_GAME_NAME Tipps 2024:**  
          1. Nutze unsere Links zwischen 8-10 Uhr CET f√ºr maximale Belohnungen  
          2. Kombiniere sie mit t√§glichen Login-Boni f√ºr den 2-fachen Effekt  
          3. Aktiviere Push-Benachrichtigungen f√ºr zeitlich begrenzte Angebote  

          ‚ö†Ô∏è **Wichtig:** Erfordert Version $((RANDOM%5+2)).$((RANDOM%50)).+  
          [Jetzt aktualisieren](https://play.google.com/store/apps/details?id=com.$GAME_NAME) | [iOS-Version](https://apps.apple.com/app/$GAME_NAME)  

          **Nutzerstatistik:**  
          üèÜ Durchschnittliche Bonussteigerung: $((RANDOM%300+150))%  
          ‚è±Ô∏è W√∂chentlich gesparte Zeit: $((RANDOM%10+5)) Stunden  

          *¬ªZuletzt best√§tigt: vor 2 Minuten von Benutzer #$((RANDOM%10000+1))¬´*"

          echo "$SEO_CONTENT" > "$POST_FILE"

      - name: Create Conversion-Optimized Footers
        run: |
          GAME_NAME=${{ matrix.game }}
          FORMATTED_GAME_NAME=$(echo "$GAME_NAME" | sed 's/-/ /g' | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)}1')

          FOOTER_FILE="_includes/${GAME_NAME}_footer.html"
          
          SCHEMA_JSON='<script type="application/ld+json">
          {
            "@context": "https://schema.org",
            "@type": "VideoGame",
            "name": "$FORMATTED_GAME_NAME Belohnungen",
            "description": "Kostenlose Ressourcen f√ºr $FORMATTED_GAME_NAME",
            "applicationCategory": "CasinoGame",
            "author": {
              "@type": "Organization",
              "name": "BonusCollector"
            }
          }
          </script>'

          FOOTER_CONTENT="## ‚ö° $FORMATTED_GAME_NAME Profi-Strategien

          **Maximiere deine Gewinne:**  
          üîÑ Verwende 3 Ger√§te gleichzeitig f√ºr 3-fache Boni  
          üïí Beste Einl√∂sezeiten: 8-9 Uhr & 18-19 Uhr CET  
          üõë Vermeide diese 3 h√§ufigen Fehler:  
          1. Zu schnelles Klicken (warte 3 Sekunden zwischen den Links)  
          2. Fehlende Kontoverifizierung  
          3. Nutzung veralteter App-Versionen  

          $SCHEMA_JSON"

          echo "$FOOTER_CONTENT" > "$FOOTER_FILE"

      - name: Deploy Changes
        env: 
          DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        run: |
          git config --global user.email "prolladmail@gmail.com"
          git config --global user.name "BonusCollector SEO Bot"
          git add _includes/*.html links-json/*.json
          git commit -m "SEO Update: ${{ matrix.game }} (v$(date +%s))"
          git push https://x-access-token:$DEPLOY_KEY@github.com/Prollad99/bs-de.git HEAD:main
