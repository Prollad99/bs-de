name: Update Links and Deployment

on:
  schedule:
    - cron: '*/30 * * * *' # Runs every 30 minutes
  push:
    branches:
      - main

jobs:
  update-links:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        game:
          - coin-master
          - monopoly-go
          - bingo-blitz
          - dice-dreams
          - match-masters
          - solitaire-grand-harvest
          - slotpark
          - house-of-fun
          - slotomania
          - bingo-bash
          - huuuge-casino
          - wsop
          - crazy-coin
          - gametwist

    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Cache Node modules
        uses: actions/cache@v2
        with:
          path: ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: Install dependencies
        run: npm install

      - name: Install Playwright browser
        run: npx playwright install

      - name: Fetch and update links
        run: |
          node index-js/${{ matrix.game }}.js
          echo "Contents of links-json/${{ matrix.game }}.json:"
          cat links-json/${{ matrix.game }}.json
          echo "Contents of _includes/${{ matrix.game }}.html:"
          cat _includes/${{ matrix.game }}.html

      - name: Generate dynamic content
        run: |
          declare -A GAME_TYPES
          GAME_TYPES=(
            ["bingo-bash"]="Free Chips"
            ["bingo-blitz"]="Free Credits"
            ["coin-master"]="Free Spins"
            ["crazy-coin"]="Free Spins"
            ["dice-dreams"]="Free Rolls"
            ["gametwist"]="Free Coins"
            ["house-of-fun"]="Free Coins"
            ["huuuge-casino"]="Free Chips"
            ["match-masters"]="Free Gifts"
            ["monopoly-go"]="WÃ¼rfel"
            ["slotomania"]="Free Coins"
            ["slotpark"]="Bonus Code"
            ["solitaire-grand-harvest"]="Free Coins"
            ["wsop"]="Free Chips"
          )

          GAME_NAME=${{ matrix.game }}
          GAME_NAME_CAPITALIZED=$(echo "$GAME_NAME" | sed 's/-/ /g' | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)}1')
          GAME_TYPE=${GAME_TYPES[$GAME_NAME]}

          POST_FILE="_includes/${GAME_NAME}_post.html"
          FOOTER_FILE="_includes/${GAME_NAME}_footer.html"

          POST_CONTENT="Are you a dedicated **${GAME_NAME_CAPITALIZED}** player? Want to collect **${GAME_TYPE}** without spending real money? Youâ€™re in the right place!  

          We update this page **every day** with fresh **${GAME_TYPE}** links so you can boost your gameplay, level up faster, and unlock exciting rewardsâ€”all for free.  

          ---  

          ## **What Are ${GAME_TYPE} Links?**  

          **${GAME_TYPE}** links are official rewards from **${GAME_NAME_CAPITALIZED}** developers, offering free **${GAME_TYPE}** and other in-game bonuses like spins, rolls, credits, and special gifts.  

          Instead of searching for them yourself, we do the work for you! We gather and update the latest working links daily, so you can claim your free rewards hassle-free.  

          ---  

          ## **How to Claim Your Free ${GAME_TYPE}**  

          Getting your free **${GAME_TYPE}** is quick and easy:  

          1. **Choose a link from the list below.**  
          2. **Click the link and sign in to your ${GAME_NAME_CAPITALIZED} account.**  
          3. **Enjoy your free ${GAME_TYPE}â€”instantly added to your game!**  

          > ðŸ”” **Pro Tip:** These links expire fast, so check back daily to grab yours before theyâ€™re gone!  

          ---  

          ## **Todayâ€™s Free ${GAME_TYPE} for ${GAME_NAME_CAPITALIZED}**"

          FOOTER_CONTENT="---  

          ## **Why Bookmark This Page?**  

          We make it easy to stay ahead in **${GAME_NAME_CAPITALIZED}** with daily updates and verified links. Hereâ€™s why you should visit us daily:  

          âœ… **Daily Updates:** We post the latest free **${GAME_TYPE}** links every day.  
          âœ… **100% Safe & Verified:** All links come from official **${GAME_NAME_CAPITALIZED}** sources.  
          âœ… **Completely Free:** No sign-ups, no hidden feesâ€”just free in-game rewards!  

          ---  

          ## **Maximize Your Free ${GAME_TYPE} with These Pro Tips**  

          Want to get the most out of your free rewards? Follow these expert strategies:  

          - **Use Spins & Rolls Wisely:** Save them for high-reward events.  
          - **Manage Coins & Credits Smartly:** Spend strategically to progress faster.  
          - **Log in Daily:** Many links have a short lifespanâ€”claim them ASAP!  

          ---  

          ## **FAQs â€“ Your Questions Answered**  

          ### **1. Are these ${GAME_TYPE} links safe to use?**  
          Yes! We only share links directly from official **${GAME_NAME_CAPITALIZED}** promotions, so theyâ€™re completely safe and legitimate.  

          ### **2. How often do you update the links?**  
          We update this page **daily** with new working links, so be sure to check back every day.  

          ### **3. What if a link doesnâ€™t work?**  
          Some links have a limited number of redemptions or expire quickly. If one isnâ€™t working, donâ€™t worryâ€”new ones will be available soon!  

          ---  

          ## **Disclaimer**  

          We are **not affiliated** with **${GAME_NAME_CAPITALIZED}** or its developers. This page is solely for informational purposes to help players claim free **${GAME_TYPE}** and enjoy the game to the fullest."

          echo -e "$POST_CONTENT" > "$POST_FILE"
          echo -e "$FOOTER_CONTENT" > "$FOOTER_FILE"

      - name: Configure Git
        run: |
          git config --global user.email "prolladmail@gmail.com"
          git config --global user.name "Prollad99"

      - name: Commit and push changes
        env:
          ACTIONS_DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        run: |
          git add _includes/${{ matrix.game }}.html _includes/${{ matrix.game }}_post.html _includes/${{ matrix.game }}_footer.html links-json/${{ matrix.game }}.json
          git commit -m "Update ${{ matrix.game }} reward links, content, and last modified date" || true
          git push https://x-access-token:${{ secrets.ACTIONS_DEPLOY_KEY }}@github.com/Prollad99/bs-de.git || true