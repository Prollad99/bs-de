name: Automatische Inhaltsaktualisierungen & SEO

on:
  schedule:
    - cron: '*/30 * * * *' # Alle 30 Minuten
  push:
    branches:
      - main

jobs:
  content-update:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        game:
          - coin-master
          - monopoly-go
          - bingo-blitz
          - dice-dreams
          - match-masters
          - solitaire-grand-harvest
          - slotpark
          - house-of-fun
          - slotomania
          - bingo-bash
          - huuuge-casino
          - wsop
          - crazy-coin

    steps:
      - name: Repository auschecken
        uses: actions/checkout@v3

      - name: Abh√§ngigkeiten installieren
        run: |
          npm install
          npx playwright install

      - name: Spiel-Links aktualisieren
        run: node index-js/${{ matrix.game }}.js

      - name: SEO-Inhalt generieren
        env:
          CURRENT_DATE: $(date +'%Y-%m-%d')
        run: |
          GAME_NAME=${{ matrix.game }}
          FORMATTED_NAME=$(echo "$GAME_NAME" | sed 's/-/ /g' | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)}1')

          # Beitragstext generieren
          echo "### üéÆ $FORMATTED_NAME Gratis-Belohnungen (Aktualisiert: $CURRENT_DATE)

          Erhalte t√§glich aktualisierte $FORMATTED_NAME-Links f√ºr:
          ‚úÖ Kostenlose Spins
          ‚úÖ Bonus-M√ºnzen
          ‚úÖ Zeitlich begrenzte Angebote

          **Warum unsere Links nutzen?**
          - Alle 30 Minuten aktualisiert
          - Funktioniert auf allen Ger√§ten
          - Kein Login erforderlich

          ‚ö†Ô∏è Voraussetzungen:
          - Neueste Spielversion installiert
          - Stabile Internetverbindung

          *√úberpr√ºft und funktionsf√§hig seit $CURRENT_DATE*" > "_includes/${GAME_NAME}_post.html"

          # Fu√üzeile generieren
          echo "## üîç So l√∂st du $FORMATTED_NAME-Belohnungen ein
          1. Klicke auf einen der oben genannten Links
          2. Warte, bis das Spiel startet
          3. Belohnungen werden automatisch eingel√∂st

          **Tipps:**
          - Links verfallen nach 48 Stunden
          - Seite aktualisieren f√ºr neue Updates
          - Kontaktiere den Support bei fehlgeschlagenen Einl√∂sungen" > "_includes/${GAME_NAME}_footer.html"

      - name: √Ñnderungen bereitstellen
        env: 
          DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        run: |
          git config user.email "prolladmail@gmail.com"
          git config user.name "Auto-Updater"
          git add _includes/
          git commit -m "Aktualisiere ${{ matrix.game }} Inhalt"
          git push https://x-access-token:$DEPLOY_KEY@github.com/Prollad99/bs-de.git HEAD:main