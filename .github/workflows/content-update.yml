name: Automated Content Updates & SEO

on:
  schedule:
    - cron: '*/30 * * * *' # Every 30 minutes
  push:
    branches:
      - main

jobs:
  content-update:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        game:
          - coin-master
          - monopoly-go
          - bingo-blitz
          - dice-dreams
          - match-masters
          - solitaire-grand-harvest
          - slotpark
          - house-of-fun
          - slotomania
          - bingo-bash
          - huuuge-casino
          - wsop
          - crazy-coin

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Install Dependencies
        run: |
          npm install
          npx playwright install

      - name: Update Game Links
        run: node index-js/${{ matrix.game }}.js

      - name: Generate SEO Content
        run: |
          CURRENT_DATE=$(date +'%Y-%m-%d')  # Get current date in YYYY-MM-DD format
          GAME_NAME=${{ matrix.game }}
          
          # Format game name for display
          FORMATTED_NAME=$(echo "$GAME_NAME" | sed 's/-/ /g' | awk '{for(i=1;i<=NF;i++) $i=toupper(substr($i,1,1)) substr($i,2)}1')

          # Generate post content with dynamic date
          echo "### 🎮 $FORMATTED_NAME Kostenlose Belohnungen (Aktualisiert: $CURRENT_DATE)

          Erhalte täglich aktualisierte $FORMATTED_NAME-Links für:
          ✅ Kostenlose Spins  
          ✅ Bonusmünzen  
          ✅ Zeitlich begrenzte Angebote  

          **Warum unsere Links verwenden?**  
          - Alle 30 Minuten aktualisiert  
          - Funktioniert auf allen Geräten  
          - Kein Login erforderlich  

          ⚠️ Voraussetzungen:  
          - Neueste Spielversion installiert  
          - Stabile Internetverbindung  

          *Überprüft und funktionsfähig ab $CURRENT_DATE*" > "_includes/${GAME_NAME}_post.html"

          # Generate footer content
          echo "## 🔍 So löst du $FORMATTED_NAME-Belohnungen ein  
          1. Klicke auf einen beliebigen Link oben  
          2. Warte, bis das Spiel startet  
          3. Deine Belohnungen werden automatisch eingelöst  

          **Tipps:**  
          - Links verfallen nach 48 Stunden  
          - Aktualisiere die Seite für neue Updates  
          - Kontaktiere den Support bei fehlgeschlagenen Ansprüchen" > "_includes/${GAME_NAME}_footer.html"

      - name: Deploy Changes
        env: 
          DEPLOY_KEY: ${{ secrets.ACTIONS_DEPLOY_KEY }}
        run: |
          git config user.email "prolladmail@gmail.com"
          git config user.name "Auto-Updater"
          
          # Stage and commit changes
          git add -A
          git commit -m "Update ${{ matrix.game }} content for $(date +'%Y-%m-%d')" || echo "No changes to commit"
          
          # Handle potential conflicts
          git fetch origin
          git rebase origin/main || git merge origin/main
          
          # Push changes
          git push https://x-access-token:$DEPLOY_KEY@github.com/Prollad99/bs-de.git HEAD:main